<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="NOTC">
    <meta name="author" content="MingYuan">
	<meta name="generator" content="Notepad++">
    <link rel="icon" href="img/logo.png">

<title>出售</title>
           
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      
    <link rel="stylesheet" href="css/magnific-popup.css">                                     
    <link rel="stylesheet" href="css/templatemo-style.css">   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.3.7/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="static/css/style.css?_=1.0.5">
    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <link rel="stylesheet" href="editor.md/css/editormd.preview.min.css" />
    <link href="css/airdrop.css" rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
    <link href="css/core.css" rel="stylesheet" type="text/css">
    <link href="css/components.css" rel="stylesheet" type="text/css">
    <link href="css/colors.css" rel="stylesheet" type="text/css">
    <link href="css/summernote.css" rel="stylesheet" type="text/css">
    <link href="css/owl.carousel.min.css" rel="stylesheet" type="text/css">
    <link href="css/owl.theme.default.min.css" rel="stylesheet" type="text/css">
                                  
    <script type="text/javascript" src="./jquery-3.3.1.min.js"></script> 
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.2.6/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3.0.1/dist/vue-router.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-ui@2.3.7/lib/index.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/nebPay.js"></script>
    <script src="js/nebulas.js"></script>
    <script src="js/nebConfig.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="js/buyConfig.js"></script>
    <script src="js/bootstrap.min2.js"></script>
    <script src="js/getWallectInfo.js?_=201805241200"></script>

  </head>

<body id="top" class="home">

<div class="tm-navbar-container tm-navbar-container-dark">
    <nav class="navbar navbar-full navbar-fixed-top bg-inverse">
		<button class="navbar-toggler hidden-md-up" type="button" data-toggle="collapse" data-target="#tmNavbar">
			&#9776;
		</button>
		    <div class="collapse navbar-toggleable-sm" id="tmNavbar">
		    	<ul class="nav navbar-nav">
					<li class="nav-item">
						<a class="nav-link" href="index.html">首页</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="transactioning.html">出售</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="buyadvertising.html">发布购买广告</a>
					</li>
					<li class="nav-item">
						<a class="nav-link external" href="interpretation.html">使用教程</a>
					</li>
				        <li class="nav-item">
						<a class="nav-link external" href="lianxi.html">联系我们</a>
					</li>
					<li id="app" class="nav-item">
						<a class="nav-link" >账户信息:{{balance}} NAS</a>
					
					</li>
				</ul>
			</div>		  
		</nav>
	</div>  

   
	<section class="referrer-section" >
	  <div class="container">
        <div class="card-deck mb-3 text-center">
          <div class="card mb-4 box-shadow" style="margin-top: 130px">
			<h1 class="text-xs-center blue-text tm-page-2-title" style="margin-top: 50px">填写你的出售信息</h1>
			 <div class="card-body">
			  <h4 class="btn-lg" style="margin-top: 30px">联系方式</h4>
              <input type="text" class="form-control" name="contactWay" id="input_car" placeholder="微信、QQ、邮箱皆可！系统稍后会通知买家！请耐心等待对方与你联系！">                
              <br>
              <button type="button" style="margin-top: 35px" class="btn btn-lg btn-block tm-green-btn" id="sale">确认提交信息</button>          
            </div>
          </div>
        </div>
	  </div>
    </section>
	  

     <script>
      "use strict";
      var nebulas = require("nebulas");
      var Account = nebulas.Account;
      var neb = new nebulas.Neb();
      neb.setRequest(new nebulas.HttpRequest(rpcURL));
      var nasApi = neb.api;
      var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
      var nebPay = new NebPay();
      var serialNumber;

	  
      $('#sale').click(function () {
	  if (checkWallet()){
        if (!$("#input_car").val()) {
            $('#checksale').modal('show');
            return;
        }
		}
        var to = dappcontractsaleAddress;
        var value = "0";
        var callFunction = "save";
        var callArgs = "[\"" + $("#input_car").val() + "\",\"none\"]";
        console.log(callArgs);

        serialNumber = nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
            listener: function (resp) {
                  if(resp !== 'Error: Transaction rejected by user'){
                    $('#packing').modal('show');
					var hash = resp.txhash;
                  recheckTransaction(hash, function (resp) {
                    $('#packing').modal('hide');
                    $('#packingSuccess').modal('show');
                    callback && callback(resp);
                   })
                  }else {
                    $('#packingFailur').modal('show');
                }
            }
        });

    })

      function getTransaction(hash, callback){
        $.post(rpcURL + '/v1/user/getTransaction', JSON.stringify({
          "hash": hash
        }), function (resp) {
          callback(resp)
        })
      }

      function recheckTransaction(hash, cb) {
        var task = setInterval(function () {
          getTransaction(hash, function (resp) {
            var status = resp.result.status;
            if(status == 1){
              clearInterval(task);
              cb();
            }
          })
        }, 1000);
      }
	  	  

      function checkWallet(){
          if (typeof (webExtensionWallet) === "undefined") {
              $(document).ready(function(){
                  $("#noWallet").modal('show');
              });
              return false;
          }

          return true;

      }

    </script>

  <div id="checksale" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">友情提示！</h4>
        </div>
        <div class="modal-body">
          <p>联系方式不能为空！</p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  
  
  <div id="noWallet" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">友情提示！</h4>
        </div>
        <div class="modal-body">
          <p>你没有安装星云钱包，请使用谷歌浏览器安装星云钱包插件： <a href="https://github.com/nebulasotc/nasqianbao" target="_blank">钱包链接</a></p>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  
  <div id="packing" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">友情提示!</h4>
          </div>
          <div class="modal-body">
            <p>请耐心等待！交易正在打包，稍等片刻！</p>
          </div>
          <div class="modal-footer"  style="padding-top: 10px">
            <br>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="packingSuccess" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">友情提示！</h4>
          </div>
          <div class="modal-body">
            <p>恭喜你！交易打包成功！</p>
          </div>
          <div class="modal-footer"  style="padding-top: 10px">
            <br>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
	
	<div id="packingFailur" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">友情提示！</h4>
          </div>
          <div class="modal-body">
            <p>你已取消交易！</p>
          </div>
          <div class="modal-footer"  style="padding-top: 10px">
            <br>
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-6 col-md">
            <h5>友情链接</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="https://nebulas.io" target="_blank">星云官网</a></li>
              <li><a class="text-muted" href="https://explorer.nebulas.io" target="_blank">星云区块浏览器</a></li>
              <li><a class="text-muted" href="https://github.com/ChengOrangeJu/WebExtensionWallet" target="_blank">星云钱包插件</a></li>
              <li><a class="text-muted" href="https://incentive.nebulas.io/cn/signup.html?invite=QIdur" target="_blank">我也要开发</a></li>
			  <li><a class="text-muted" href="https://blog.csdn.net/lc326514244/article/details/80347136" target="_blank">最全开发教程</a></li>
              <li><a class="text-muted" href="https://blog.csdn.net/wingichoy/article/details/80291665" target="_blank">真正零门槛入门</a></li>
            </ul>
          </div>
          <div class="col-6 col-md">
            <h5>其他优质星云DAPP链接</h5>
            <ul class="list-unstyled text-small">
			<li><a class="text-muted" href="https://bbs.forfunapp.com/" target="_blank">链社区-基于星云链的微论坛</a></li>
			<li><a class="text-muted" href="http://nebulas.cool" target="_blank">星云链DApp商店</a></li>
			<li><a class="text-muted" href="http://cellevo.net/" target="_blank">细胞进化</a></li>
			<li><a class="text-muted" href="http://xu.renmaixifen.com/" target="_blank">NAS手气红包</a></li>
			<li><a class="text-muted" href="https://nasdrop.info/" target="_blank">星云空投</a></li>
			<li><a class="text-muted" href="http://nas.lubi.ren/" target="_blank">LuckyBlock</a></li>
			<li><a class="text-muted" href="http://sunnypickle.coding.me/nebulasgame/" target="_blank">星云修仙传</a></li>
			<li><a class="text-muted" href="http://nasweb.top/" target="_blank">2Dspace-Estate</a></li>
            </ul>
          </div>
        </div>
      </footer>
  </body>
</html>
